<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Nandha Chatbot Management System â€” Admin Panel</title>

<!-- Google Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">

<!-- Icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<style>
    * { box-sizing: border-box; }
    
    body {
        margin: 0;
        font-family: "Poppins", sans-serif;
        background: linear-gradient(135deg, #0f172a, #1e293b, #0f172a);
        color: white;
        height: 100vh;
        display: flex;
        transition: all 0.3s;
    }
    
    /* Dark Mode */
    body.dark-mode {
        background: linear-gradient(135deg, #000000, #0f0f0f, #1a1a1a);
    }
    
    body.dark-mode .sidebar {
        background: rgba(0,0,0,0.5);
    }
    
    body.dark-mode .card {
        background: rgba(0,0,0,0.4);
    }

    /* Sidebar */
    .sidebar {
        width: 260px;
        background: rgba(255,255,255,0.07);
        backdrop-filter: blur(10px);
        padding: 20px;
        height: 100vh;
        border-right: 1px solid rgba(255,255,255,0.1);
        overflow-y: auto;
    }

    .sidebar h2 {
        font-size: 20px;
        text-align: center;
        margin-bottom: 30px;
        letter-spacing: 1px;
    }

    .menu a {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 12px 15px;
        margin-bottom: 10px;
        background: rgba(255,255,255,0.05);
        border-radius: 10px;
        text-decoration: none;
        color: #cbd5e1;
        transition: 0.3s;
        cursor: pointer;
    }

    .menu a:hover {
        background: rgba(255,255,255,0.15);
        transform: translateX(5px);
    }

    /* Main content */
    .content {
        flex: 1;
        padding: 30px;
        overflow-y: auto;
    }

    .section {
        display: none;
        animation: fadeIn 0.4s ease-in;
    }

    .section.active {
        display: block;
    }

    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
    }

    .card {
        background: rgba(255,255,255,0.08);
        padding: 20px;
        border-radius: 15px;
        backdrop-filter: blur(12px);
        margin-bottom: 25px;
        border: 1px solid rgba(255,255,255,0.1);
    }

    .card h3 {
        margin-top: 0;
        color: #93c5fd;
        font-size: 18px;
        border-bottom: 1px solid rgba(255,255,255,0.1);
        padding-bottom: 10px;
        margin-bottom: 15px;
    }

    input, select, textarea {
        width: 100%;
        padding: 10px;
        border-radius: 8px;
        border: none;
        margin: 8px 0;
        background: rgba(255,255,255,0.15);
        color: white;
        outline: none;
        font-family: inherit;
    }
    
    input::placeholder, textarea::placeholder {
        color: rgba(255,255,255,0.5);
    }

    button {
        padding: 12px 18px;
        background: #3b82f6;
        border: none;
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        color: white;
        transition: 0.3s;
        margin: 5px;
    }

    button:hover {
        background: #60a5fa;
        transform: scale(1.05);
    }
    
    button:active {
        transform: scale(0.95);
    }

    table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 15px;
    }

    th, td {
        padding: 12px;
        border-bottom: 1px solid rgba(255,255,255,0.15);
        text-align: left;
    }

    th {
        color: #93c5fd;
        font-weight: 600;
    }
    
    .stat-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin: 20px 0;
    }
    
    .stat-card {
        padding: 20px;
        border-radius: 10px;
        text-align: center;
    }
    
    .stat-card .number {
        font-size: 32px;
        font-weight: bold;
        margin-bottom: 5px;
    }
    
    .stat-card .label {
        font-size: 13px;
        opacity: 0.8;
    }
</style>
</head>

<body>

<!-- ================= SIDEBAR ================= -->
<div class="sidebar">
    <h2>ğŸ“ ADMIN PANEL</h2>

    <div class="menu">
        <a onclick="showSection('dashboard')"><i class="fa fa-home"></i> Dashboard</a>
        <a onclick="showSection('analytics')"><i class="fa fa-chart-pie"></i> Analytics</a>
        <a onclick="showSection('users')"><i class="fa fa-users"></i> User Management</a>
        <a onclick="showSection('lockControl')"><i class="fa fa-lock"></i> Lock/Unlock</a>
        <a onclick="showSection('warnings')"><i class="fa fa-triangle-exclamation"></i> Warnings</a>
        <a onclick="showSection('course')"><i class="fa fa-book"></i> Course Plans</a>
        <a onclick="showSection('notices')"><i class="fa fa-bell"></i> Notices</a>
        <a onclick="showSection('messaging')"><i class="fa fa-envelope"></i> Messages</a>
        <a onclick="showSection('rewards')"><i class="fa fa-gift"></i> Rewards</a>
        <a onclick="showSection('audit')"><i class="fa fa-history"></i> Audit Logs</a>
        <a onclick="toggleDarkMode()"><i class="fa fa-moon"></i> Dark Mode</a>
        <a onclick="logout()"><i class="fa fa-right-from-bracket"></i> Logout</a>
    </div>
</div>

<!-- ================= MAIN CONTENT ================= -->
<div class="content">

    <!-- ============================================ -->
    <!-- 1. DASHBOARD -->
    <!-- ============================================ -->
    <div id="dashboard" class="section active">
        <h2>ğŸ‘‹ Welcome, Admin!</h2>
        <p style="opacity:0.8;">Manage your Smart Chatbot Management System from here.</p>
        
        <div class="stat-grid">
            <div class="stat-card" style="background:rgba(59,130,246,0.2);">
                <div class="number" id="totalStudents">â€”</div>
                <div class="label">Total Students</div>
            </div>
            <div class="stat-card" style="background:rgba(239,68,68,0.2);">
                <div class="number" id="lockedStudents">â€”</div>
                <div class="label">Locked Accounts</div>
            </div>
            <div class="stat-card" style="background:rgba(249,115,22,0.2);">
                <div class="number" id="warningStudents">â€”</div>
                <div class="label">With Warnings</div>
            </div>
            <div class="stat-card" style="background:rgba(34,197,94,0.2);">
                <div class="number" id="activeStudents">â€”</div>
                <div class="label">Active Today</div>
            </div>
        </div>
        
        <div class="card">
            <h3>Quick Actions</h3>
            <button onclick="showSection('lockControl')">ğŸ”’ Lock/Unlock Students</button>
            <button onclick="showSection('warnings')">âš ï¸ Issue Warning</button>
            <button onclick="showSection('notices')">ğŸ“¢ Create Notice</button>
            <button onclick="showSection('messaging')">ğŸ’¬ Send Message</button>
            <button onclick="showSection('course')">ğŸ“˜ Upload Course Plan</button>
        </div>
    </div>

    <!-- ============================================ -->
    <!-- 2. ANALYTICS -->
    <!-- ============================================ -->
    <div id="analytics" class="section">
        <h2>ğŸ“Š Analytics Dashboard</h2>
        <div class="card">
            <h3>System Statistics</h3>
            <div class="stat-grid">
                <div class="stat-card" style="background:rgba(59,130,246,0.2);">
                    <div class="number" id="totalStudents2">â€”</div>
                    <div class="label">Total Students</div>
                </div>
                <div class="stat-card" style="background:rgba(34,197,94,0.2);">
                    <div class="number" id="activeToday">â€”</div>
                    <div class="label">Active Today</div>
                </div>
                <div class="stat-card" style="background:rgba(239,68,68,0.2);">
                    <div class="number" id="lockedCount">â€”</div>
                    <div class="label">Locked Accounts</div>
                </div>
                <div class="stat-card" style="background:rgba(249,115,22,0.2);">
                    <div class="number" id="warnedCount">â€”</div>
                    <div class="label">With Warnings</div>
                </div>
            </div>
        </div>
    </div>

    <!-- ============================================ -->
    <!-- 3. USER MANAGEMENT -->
    <!-- ============================================ -->
    <div id="users" class="section">
        <h2>ğŸ‘¥ User Management</h2>

        <div class="card">
            <h3>All Students</h3>
            <input type="text" id="userSearchInput" placeholder="ğŸ” Search by name or roll..." onkeyup="filterUsers()">
            <div style="overflow-x:auto;">
                <table id="usersTable">
                    <thead>
                        <tr><th>Roll</th><th>Name</th><th>Dept</th><th>Class</th><th>Status</th><th>Actions</th></tr>
                    </thead>
                    <tbody>
                        <tr><td colspan="6" style="text-align:center;opacity:0.6;">Loading students...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- ============================================ -->
    <!-- 4. LOCK/UNLOCK CONTROL -->
    <!-- ============================================ -->
    <div id="lockControl" class="section">
        <h2>ğŸ”’ Lock & Unlock Students</h2>

        <div class="card">
            <h3>Lock/Unlock Specific Student</h3>
            <input type="text" id="studentLock" placeholder="Enter student roll number (e.g., 2023CS001)">
            <input type="number" id="lockSeconds" placeholder="Lock duration in seconds (default: 86400 = 1 day)" value="86400">
            <div style="margin-top:15px;">
                <button onclick="lockStudent()" style="background:#ef4444;">ğŸ”’ Lock Student</button>
                <button onclick="unlockStudent()" style="background:#22c55e;">ğŸ”“ Unlock Student</button>
            </div>
            <p style="font-size:12px;opacity:0.7;margin-top:10px;">
                ğŸ’¡ Tip: Use the "Select" button in User Management table to auto-fill roll number
            </p>
        </div>
    </div>

    <!-- ============================================ -->
    <!-- 5. WARNINGS -->
    <!-- ============================================ -->
    <div id="warnings" class="section">
        <h2>âš ï¸ Issue Warnings & Violations</h2>

        <div class="card">
            <h3>Issue Warning</h3>
            <input type="text" id="studentWarning" placeholder="Enter student roll number">
            <select id="warningLevel">
                <option value="low">âš ï¸ Low - Minor violation</option>
                <option value="medium">âš ï¸ Medium - Moderate violation</option>
                <option value="high">ğŸš¨ High - Serious violation</option>
            </select>
            <textarea id="warningReason" placeholder="Reason for warning..." style="min-height:100px;"></textarea>
            <button onclick="issueWarning()" style="background:#f59e0b;">âš ï¸ Issue Warning</button>
        </div>

        <div class="card">
            <h3>View Student Warnings</h3>
            <input type="text" id="warningsViewRoll" placeholder="Enter roll number">
            <button onclick="loadWarnings(document.getElementById('warningsViewRoll').value)">Load Warnings</button>
            <div id="warningsContainer" style="margin-top:15px;">
                <p style="opacity:0.6;">Enter a roll number above to view warnings</p>
            </div>
        </div>
    </div>

    <!-- ============================================ -->
    <!-- 6. COURSE PLANS -->
    <!-- ============================================ -->
    <div id="course" class="section">
        <h2>ğŸ“˜ Course Plan Management</h2>

        <div class="card">
            <h3>Upload Course Plan (PDF)</h3>
            <input type="text" id="planName" placeholder="Optional: Plan name (auto-detected from filename)">
            <input type="file" id="planFile" accept="application/pdf" style="padding:20px;background:rgba(255,255,255,0.1);border:2px dashed rgba(255,255,255,0.3);">
            <button id="planBtn" onclick="uploadCoursePlan()">ğŸ“¤ Upload PDF</button>
        </div>

        <div class="card">
            <h3>Uploaded Course Plans</h3>
            <div style="overflow-x:auto;">
                <table id="plansTable">
                    <thead>
                        <tr><th>File Name</th><th>Uploaded</th><th>Action</th></tr>
                    </thead>
                    <tbody>
                        <tr><td colspan="3" style="text-align:center;opacity:0.6;">No course plans uploaded yet</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- ============================================ -->
    <!-- 7. NOTICES -->
    <!-- ============================================ -->
    <div id="notices" class="section">
        <h2>ğŸ“¢ Notices & Announcements</h2>
        
        <div class="card">
            <h3>Create New Notice</h3>
            <input type="text" id="noticeTitle" placeholder="Notice Title">
            <textarea id="noticeBody" placeholder="Notice Body" style="min-height:120px;"></textarea>
            <label style="display:flex;align-items:center;gap:8px;margin:10px 0;cursor:pointer;">
                <input type="checkbox" id="noticeUrgent" style="width:auto;margin:0;">
                <span>ğŸ”´ Mark as Urgent/Pin to top</span>
            </label>
            <button onclick="createNotice()">ğŸ“¢ Send Notice</button>
        </div>
        
        <div class="card">
            <h3>Recent Notices</h3>
            <div id="noticesContainer" style="max-height:400px;overflow-y:auto;">
                <p style="opacity:0.6;">Loading notices...</p>
            </div>
        </div>
    </div>

    <!-- ============================================ -->
    <!-- 8. DIRECT MESSAGES -->
    <!-- ============================================ -->
    <div id="messaging" class="section">
        <h2>ğŸ’¬ System Messages</h2>
        
        <div class="card">
            <h3>Send Direct Message</h3>
            <input type="text" id="msgTitle" placeholder="Message Title">
            <textarea id="msgContent" placeholder="Message Content" style="min-height:120px;"></textarea>
            <select id="msgType">
                <option value="info">â„¹ï¸ Info</option>
                <option value="warning">âš ï¸ Warning</option>
                <option value="alert">ğŸš¨ Alert</option>
                <option value="success">âœ… Success</option>
            </select>
            <input type="text" id="msgRecipients" placeholder="Recipient roll numbers (comma separated: 2023CS001, 2023CS002)">
            <button onclick="sendDirectMessage()">ğŸ“¨ Send Message</button>
        </div>
        
        <div class="card">
            <h3>Broadcast Message to All</h3>
            <select id="broadcastFilter">
                <option value="all">ğŸ“¢ Send to All Students</option>
                <option value="dept">By Department</option>
                <option value="locked">Only Locked Accounts</option>
            </select>
            <input type="text" id="broadcastTitle" placeholder="Broadcast Title">
            <textarea id="broadcastContent" placeholder="Broadcast Content" style="min-height:100px;"></textarea>
            <button onclick="broadcastMessage()">ğŸ“¡ Send Broadcast</button>
        </div>

        <div class="card">
            <h3>Message Templates</h3>
            <select id="templateSelect"><option value="">-- Select Template --</option></select>
            <button onclick="loadTemplate()">Load</button>
            <button onclick="createTemplate()">â• Create New Template</button>
            <hr style="border-color:rgba(255,255,255,0.1);margin:15px 0;">
            <div style="margin-top:10px;">
                <input type="text" id="templateTitle" placeholder="Template title">
                <textarea id="templateBody" placeholder="Template body" style="min-height:80px;"></textarea>
                <select id="templateType">
                    <option value="info">Info</option>
                    <option value="warning">Warning</option>
                    <option value="reward">Reward</option>
                </select>
            </div>
            <div id="templateList" style="max-height:200px;overflow-y:auto;margin-top:15px;"></div>
        </div>
    </div>

    <!-- ============================================ -->
    <!-- 9. REWARDS SYSTEM -->
    <!-- ============================================ -->
    <div id="rewards" class="section">
        <h2>ğŸ Rewards & Achievements</h2>
        
        <div class="card">
            <h3>Send Reward/Achievement</h3>
            <input type="text" id="rewardRecipient" placeholder="Student roll number">
            <input type="text" id="rewardTitle" placeholder="Reward Title (e.g., Top Performer, Perfect Attendance)">
            <textarea id="rewardContent" placeholder="Reward description and congratulations message" style="min-height:100px;"></textarea>
            <input type="number" id="rewardPoints" placeholder="Reward Points (optional, e.g., 100)" min="0">
            <button onclick="sendReward()" style="background:#8b5cf6;">ğŸ† Send Reward</button>
            <p style="font-size:12px;opacity:0.7;margin-top:10px;">
                Rewards appear in student mailbox with special ğŸ icon
            </p>
        </div>
    </div>

    <!-- ============================================ -->
    <!-- 10. AUDIT LOGS -->
    <!-- ============================================ -->
    <div id="audit" class="section">
        <h2>ğŸ“‹ Audit Logs</h2>
        <div class="card">
            <h3>Admin Activity History</h3>
            <div style="max-height:500px;overflow-y:auto;border-radius:8px;background:rgba(0,0,0,0.2);padding:15px;">
                <div id="auditLogs" style="font-size:13px;opacity:0.8;">
                    <p>Audit logs feature coming soon...</p>
                    <p style="opacity:0.6;">This will track all admin actions including:</p>
                    <ul style="opacity:0.6;">
                        <li>Student locks/unlocks</li>
                        <li>Warnings issued</li>
                        <li>Messages sent</li>
                        <li>Course plan uploads</li>
                        <li>System changes</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

</div>

<!-- ============================================ -->
<!-- MODALS -->
<!-- ============================================ -->

<!-- QR Code Modal -->
<div id="qrModal" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.85);z-index:9999;align-items:center;justify-content:center;">
    <div style="background:#1e293b;padding:30px;border-radius:15px;text-align:center;max-width:400px;box-shadow:0 25px 50px rgba(0,0,0,0.5);">
        <h3 style="margin-top:0;color:#93c5fd;">Student QR Code</h3>
        <div id="qrCodeContainer" style="margin:20px auto;background:white;padding:20px;border-radius:10px;display:inline-block;"></div>
        <p id="qrStudentInfo" style="font-size:14px;margin:15px 0;color:#cbd5e1;"></p>
        <button onclick="closeQRModal()" style="margin-top:15px;">âœ–ï¸ Close</button>
    </div>
</div>

<!-- Student Detail Modal -->
<div id="studentDetailModal" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.85);z-index:9999;align-items:center;justify-content:center;overflow-y:auto;padding:20px;">
    <div style="background:#1e293b;padding:30px;border-radius:15px;max-width:900px;width:100%;max-height:90vh;overflow-y:auto;box-shadow:0 25px 50px rgba(0,0,0,0.5);">
        <h3 id="detailStudentName" style="margin-top:0;color:#93c5fd;border-bottom:2px solid rgba(255,255,255,0.1);padding-bottom:10px;">Student Details</h3>
        
        <div id="detailStudentInfo" style="margin:20px 0;">
            <p style="opacity:0.6;">Loading student information...</p>
        </div>
        
        <div style="margin:25px 0;">
            <h4 style="color:#93c5fd;border-bottom:1px solid rgba(255,255,255,0.1);padding-bottom:8px;">ğŸ’¬ Chat History (Last 50 messages)</h4>
            <div id="detailChatHistory" style="max-height:350px;overflow-y:auto;background:rgba(0,0,0,0.3);padding:15px;border-radius:10px;margin-top:10px;">
                <p style="opacity:0.6;">Loading chat history...</p>
            </div>
        </div>
        
        <div style="margin:25px 0;">
            <h4 style="color:#93c5fd;border-bottom:1px solid rgba(255,255,255,0.1);padding-bottom:8px;">âš ï¸ Warnings & Violations</h4>
            <div id="detailWarnings" style="margin-top:10px;"></div>
        </div>
        
        <button onclick="closeStudentDetailModal()" style="margin-top:20px;width:100%;">âœ–ï¸ Close</button>
    </div>
</div>

<!-- ============================================ -->
<!-- SCRIPTS -->
<!-- ============================================ -->
<script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
<script src="admin.js"></script>

</body>
</html>
